<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Portfolio Analysis - FinBERT</title>
    <link rel="stylesheet" href="{{ url_for('static', filename='css/style.css') }}">
    <script src="https://cdn.plot.ly/plotly-2.26.0.min.js"></script>
</head>
<body>
    <!-- Toast Notification Container -->
    <div id="toastContainer" class="toast-container"></div>
    
    <div class="container">
        <header>
            <h1>ğŸ“Š Portfolio Analysis</h1>
            <p class="subtitle">AI-Powered Stock Analysis with FinBERT & Technical Indicators</p>
            <!-- Settings Button - Top Right -->
            <button class="settings-btn" onclick="togglePortfolioConfig()" title="Settings">
                âš™ï¸
            </button>
        </header>

        <div class="ticker-input-section">
            <h2>ğŸ¯ Select Stocks to Analyze</h2>
            <div class="input-group">
                <input type="text" id="tickerInput" placeholder="Enter ticker symbol (e.g., AAPL)" />
                <button onclick="addTicker()" class="btn btn-primary">Add Ticker</button>
            </div>
            
            <div class="ticker-chips" id="tickerChips">
                <!-- Ticker chips will be added here -->
            </div>
            
            <div class="action-buttons">
                <button onclick="analyzePortfolio()" class="btn btn-success" id="analyzeBtn">
                    ğŸ” Analyze Selected
                </button>
                <button onclick="analyzeSavedPortfolio()" class="btn btn-success" id="analyzePortfolioBtn" title="Analyze your saved portfolio without adding to the list">
                    ğŸ’¼ Analyze My Portfolio
                </button>
                <button onclick="loadPortfolioToSession()" class="btn btn-primary" title="Load portfolio tickers to the selection list">
                    ğŸ“‚ Load Portfolio
                </button>
                <button onclick="clearSessionTickers()" class="btn btn-secondary" id="clearBtn" title="Clear all tickers from selection list">
                    ğŸ—‘ï¸ Clear All
                </button>
            </div>
        </div>

        <div id="loadingIndicator" class="loading-indicator" style="display: none;">
            <div class="spinner"></div>
            <p>Analyzing portfolio... This may take a few minutes.</p>
        </div>

        <div id="results" style="display: none;">
            <h2>ğŸ“ˆ Analysis Results</h2>
            <div id="timestamp" class="timestamp"></div>
            
            <!-- Overall Portfolio Performance -->
            <div class="portfolio-overview">
                <div id="portfolioStats" class="portfolio-stats-grid">
                    <!-- Stats will be populated here -->
                </div>
            </div>
            
            <div class="summary-section">
                <h3>Summary & Recommendations</h3>
                <div id="summaryTable"></div>
            </div>

            <div class="details-section">
                <h3>Detailed Analysis</h3>
                <div id="detailsContainer"></div>
            </div>
        </div>
        
        <!-- Configuration Modal -->
        <div id="portfolioModal" class="modal">
            <div class="modal-content">
                <div class="modal-header">
                    <h2>âš™ï¸ Settings</h2>
                    <button class="modal-close" onclick="togglePortfolioConfig()">Ã—</button>
                </div>
                
                <!-- Tabs -->
                <div class="modal-tabs">
                    <button class="tab-btn active" onclick="switchTab('display')">
                        ğŸ“Š Display
                    </button>
                    <button class="tab-btn" onclick="switchTab('portfolio')">
                        ğŸ’¼ Portfolio
                    </button>
                    <button class="tab-btn" onclick="switchTab('about')">
                        â„¹ï¸ About
                    </button>
                </div>
                
                <div class="modal-body">
                    <!-- Display Settings Tab -->
                    <div id="displayTab" class="tab-content active">
                        <h3>ğŸ“Š Display Settings</h3>
                        <div style="margin-bottom: 15px;">
                            <label style="display: block; margin-bottom: 5px; font-weight: 600;">Default Chart Type:</label>
                            <select id="configChartType" class="chart-type-select" onchange="saveConfigSettings()" style="width: 100%;">
                                <option value="candlestick">ğŸ•¯ï¸ Candlestick</option>
                                <option value="line">ğŸ“ˆ Line Chart</option>
                                <option value="ohlc">ğŸ“Š OHLC Bars</option>
                                <option value="area">ğŸ“‰ Area Chart</option>
                                <option value="mountain">â›°ï¸ Mountain Chart</option>
                                <option value="volume">ğŸ“Š Volume Analysis</option>
                            </select>
                        </div>
                        <div style="margin-bottom: 15px;">
                            <label style="display: block; margin-bottom: 5px; font-weight: 600;">Currency Display:</label>
                            <select id="configCurrency" class="chart-type-select" onchange="saveConfigSettings()" style="width: 100%;">
                                <option value="native">Native Currency (Stock's Market)</option>
                                <option value="USD">ğŸ‡ºğŸ‡¸ US Dollar (USD)</option>
                                <option value="EUR">ğŸ‡ªğŸ‡º Euro (EUR)</option>
                            </select>
                            <small style="color: #888; font-size: 0.85em;">Note: Currency conversion not yet implemented</small>
                        </div>
                    </div>
                    
                    <!-- Portfolio Management Tab -->
                    <div id="portfolioTab" class="tab-content">
                        <h3>ğŸ’¼ Portfolio Management</h3>
                        <p style="color: #666; margin-bottom: 20px;">Manage your saved portfolio tickers. These persist across sessions.</p>
                        
                        <h4 style="margin-top: 15px;">Add Ticker to Portfolio</h4>
                        <div style="display: flex; gap: 10px; margin-bottom: 20px;">
                            <input 
                                type="text" 
                                id="portfolioTickerInput" 
                                placeholder="Enter ticker (e.g., AAPL, MSFT, TSM)"
                                style="flex: 1; padding: 10px; border: 2px solid #ddd; border-radius: 8px;"
                                onkeypress="if(event.key==='Enter') addTickerToPortfolio()"
                            >
                            <button onclick="addTickerToPortfolio()" class="btn btn-primary">
                                â• Add
                            </button>
                        </div>
                        
                        <h4>Saved Portfolio Tickers</h4>
                        <div id="savedTickersList" class="saved-tickers-list">
                            <!-- Saved tickers will be listed here -->
                        </div>
                        
                        <div class="modal-actions">
                            <button onclick="savePortfolioPreferences()" class="btn btn-success">
                                ğŸ’¾ Save Portfolio
                            </button>
                            <button onclick="clearAllTickers()" class="btn btn-danger">
                                ğŸ—‘ï¸ Clear All Tickers
                            </button>
                        </div>
                        
                        <div class="help-section">
                            <p><strong>International Tickers:</strong></p>
                            <ul style="font-size: 0.9em; margin-left: 20px; color: #666;">
                                <li>ğŸ‡ºğŸ‡¸ US: AAPL, MSFT, GOOGL</li>
                                <li>ğŸ‡®ğŸ‡ª Irish: UPL.IR, RYA.IR</li>
                                <li>ğŸ‡¬ğŸ‡§ London: HSBA.L, BP.L</li>
                                <li>ğŸ‡©ğŸ‡ª German: SAP.DE, VOW3.DE</li>
                                <li>ğŸ‡¯ğŸ‡µ Tokyo: 7203.T (Toyota), 6758.T (Sony)</li>
                                <li>ğŸ‡«ğŸ‡· Paris: MC.PA, OR.PA</li>
                            </ul>
                        </div>
                    </div>
                    
                    <!-- About Tab -->
                    <div id="aboutTab" class="tab-content">
                        <h3>â„¹ï¸ About This Application</h3>
                        <p style="color: #666; margin-bottom: 25px;">Built with powerful AI models to help you make informed investment decisions.</p>
                        
                        <h4 style="margin-top: 20px; margin-bottom: 12px;">ğŸ¤– AI Models</h4>
                        <div style="margin-left: 0; margin-bottom: 25px;">
                            <p style="margin: 8px 0; color: #555;">â€¢ <strong>FinBERT</strong> - Financial sentiment analysis (Yi Yang, HKU)</p>
                            <p style="margin: 8px 0; color: #555;">â€¢ <strong>Twitter-RoBERTa</strong> - Social media sentiment (Cardiff NLP)</p>
                            <p style="margin: 8px 0; color: #555;">â€¢ <strong>DistilBERT</strong> - Q&A assistant (HuggingFace)</p>
                        </div>
                        
                        <h4 style="margin-top: 20px; margin-bottom: 12px;">ğŸ“Š Data Sources</h4>
                        <div style="margin-left: 0; margin-bottom: 25px;">
                            <p style="margin: 8px 0; color: #555;">â€¢ <strong>Yahoo Finance</strong> - Stock prices and news</p>
                            <p style="margin: 8px 0; color: #555;">â€¢ <strong>CoinGecko</strong> - Cryptocurrency data</p>
                        </div>
                        
                        <h4 style="margin-top: 20px; margin-bottom: 12px;">ğŸ“œ License & Credits</h4>
                        <p style="margin-bottom: 10px; color: #555;">This application is open source (MIT License).</p>
                        <p style="margin-bottom: 25px;">
                            <a href="https://github.com/JewelIT/StockAnalysisHelper/blob/main/MODEL_CREDITS.md" target="_blank" style="color: #667eea; text-decoration: none; font-weight: 500;">
                                ğŸ“– View Full Model Credits & Citations â†’
                            </a>
                        </p>
                        
                        <h4 style="margin-top: 20px; margin-bottom: 12px;">ğŸŒŸ Links</h4>
                        <div style="margin-left: 0; margin-bottom: 25px;">
                            <p style="margin: 8px 0;">
                                <a href="https://github.com/JewelIT/StockAnalysisHelper" target="_blank" style="color: #667eea; text-decoration: none;">â€¢ GitHub Repository</a>
                            </p>
                            <p style="margin: 8px 0;">
                                <a href="https://github.com/JewelIT/StockAnalysisHelper/blob/main/README.md" target="_blank" style="color: #667eea; text-decoration: none;">â€¢ Documentation</a>
                            </p>
                            <p style="margin: 8px 0;">
                                <a href="https://github.com/JewelIT/StockAnalysisHelper/issues" target="_blank" style="color: #667eea; text-decoration: none;">â€¢ Report Issues</a>
                            </p>
                        </div>
                        
                        <div style="text-align: center; margin-top: 35px; padding-top: 20px; border-top: 2px solid #e0e0e0;">
                            <p style="color: #888; margin-bottom: 8px;">Built with â¤ï¸ for traders and investors worldwide</p>
                            <p style="color: #999; font-size: 0.9em; margin-top: 0;">Version 1.0.0 â€¢ October 2025</p>
                        </div>
                    </div>
                </div>
            </div>
        </div>
        
        <!-- AI Chat Assistant -->
        <div id="chatPanel" class="chat-panel">
            <div class="chat-header">
                <h3>ğŸ¤– AI Stock Assistant</h3>
                <button class="chat-toggle" onclick="toggleChat()">âœ•</button>
            </div>
            <div class="chat-messages" id="chatMessages">
                <div class="chat-message bot-message">
                    <div class="message-content">
                        ğŸ‘‹ <strong>Hello! I'm your AI Financial Advisor & Investment Mentor.</strong>
                        <br><br>
                        I provide <strong>data-driven analysis</strong> using FinBERT AI, technical indicators, and market data to help you make informed investment decisions.
                        <br><br>
                        <strong>ğŸ’¡ Ask me about:</strong>
                        <ul style="margin: 10px 0; padding-left: 20px;">
                            <li>ğŸ“Š "What do you think about AAPL?"</li>
                            <li>ğŸ’° "Should I invest in BTC-USD?"</li>
                            <li>ğŸ“ˆ "Explain the technical indicators for MSFT"</li>
                            <li>ğŸ“ "How do I start investing?"</li>
                            <li>âš–ï¸ "What are the risks I should consider?"</li>
                        </ul>
                        <strong>ğŸ›¡ï¸ My Core Principles:</strong>
                        <ul style="margin: 10px 0; padding-left: 20px; font-size: 0.9em;">
                            <li>I am specialized in <strong>financial markets only</strong> (stocks, crypto, investments)</li>
                            <li>I provide <strong>factual, data-driven analysis</strong> from verifiable sources</li>
                            <li>I always remind you that <strong>capital is at risk</strong></li>
                            <li>I emphasize <strong>proper research and due diligence</strong></li>
                            <li>I maintain my role regardless of how questions are phrased</li>
                        </ul>
                        <strong>âš ï¸ Important Disclaimers:</strong>
                        <ul style="margin: 10px 0; padding-left: 20px; font-size: 0.85em;">
                            <li><em>This is for educational purposes only, not financial advice</em></li>
                            <li><em>Always conduct your own research (DYOR)</em></li>
                            <li><em>Consult with licensed financial advisors before investing</em></li>
                            <li><em>Past performance doesn't guarantee future results</em></li>
                            <li><em>All investments carry risk - only invest what you can afford to lose</em></li>
                        </ul>
                    </div>
                </div>
            </div>
            <div class="chat-input-container">
                <select id="chatTicker" class="chat-ticker-select">
                    <option value="">Select Stock...</option>
                </select>
                <input type="text" id="chatInput" placeholder="Ask a question about the stock..." 
                       onkeypress="if(event.key==='Enter') sendChatMessage()" />
                <button onclick="sendChatMessage()" class="btn-chat-send">Send</button>
            </div>
        </div>
        
        <button class="chat-fab" onclick="toggleChat()" title="AI Assistant">
            ğŸ¤–
        </button>
    </div>

    <script src="{{ url_for('static', filename='js/app.js') }}"></script>
</body>
</html>
