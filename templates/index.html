<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Portfolio Analysis - FinBERT</title>
    <link rel="stylesheet" href="{{ url_for('static', filename='css/style.css') }}">
    <script src="https://cdn.plot.ly/plotly-2.26.0.min.js"></script>
</head>
<body>
    <div class="container">
        <header>
            <h1>📊 Portfolio Analysis</h1>
            <p class="subtitle">AI-Powered Stock Analysis with FinBERT & Technical Indicators</p>
        </header>

        <div class="ticker-input-section">
            <h2>🎯 Select Stocks to Analyze</h2>
            <div class="input-group">
                <input type="text" id="tickerInput" placeholder="Enter ticker symbol (e.g., AAPL)" />
                <button onclick="addTicker()" class="btn btn-primary">Add Ticker</button>
            </div>
            
            <div class="ticker-chips" id="tickerChips">
                <!-- Ticker chips will be added here -->
            </div>
            
            <div class="chart-type-selector">
                <label for="chartType">📊 Default Chart Type:</label>
                <select id="chartType" class="chart-type-select">
                    <option value="candlestick" selected>🕯️ Candlestick</option>
                    <option value="line">📈 Line Chart</option>
                    <option value="ohlc">📊 OHLC Bars</option>
                    <option value="area">📉 Area Chart</option>
                    <option value="mountain">⛰️ Mountain Chart</option>
                    <option value="volume">📊 Volume Analysis</option>
                </select>
                <small class="help-text">You can change chart type per stock after analysis</small>
            </div>
            
            <div class="action-buttons">
                <button onclick="analyzePortfolio()" class="btn btn-success" id="analyzeBtn">
                    🔍 Analyze Portfolio
                </button>
                <button onclick="loadPortfolioToSession()" class="btn btn-primary">
                    📂 Load My Portfolio
                </button>
                <button onclick="togglePortfolioConfig()" class="btn btn-info">
                    ⚙️ Manage Portfolio
                </button>
            </div>
        </div>

        <div id="loadingIndicator" class="loading-indicator" style="display: none;">
            <div class="spinner"></div>
            <p>Analyzing portfolio... This may take a few minutes.</p>
        </div>

        <div id="results" style="display: none;">
            <h2>📈 Analysis Results</h2>
            <div id="timestamp" class="timestamp"></div>
            
            <!-- Overall Portfolio Performance -->
            <div class="portfolio-overview">
                <div id="portfolioStats" class="portfolio-stats-grid">
                    <!-- Stats will be populated here -->
                </div>
            </div>
            
            <div class="summary-section">
                <h3>Summary & Recommendations</h3>
                <div id="summaryTable"></div>
            </div>

            <div class="details-section">
                <h3>Detailed Analysis</h3>
                <div id="detailsContainer"></div>
            </div>
        </div>
        
        <!-- Portfolio Configuration Modal -->
        <div id="portfolioModal" class="modal">
            <div class="modal-content">
                <div class="modal-header">
                    <h2>⚙️ Portfolio Configuration</h2>
                    <button class="modal-close" onclick="togglePortfolioConfig()">×</button>
                </div>
                <div class="modal-body">
                    <div class="portfolio-add-section">
                        <h3>Add Ticker to Portfolio</h3>
                        <div style="display: flex; gap: 10px; margin-bottom: 20px;">
                            <input 
                                type="text" 
                                id="portfolioTickerInput" 
                                placeholder="Enter ticker (e.g., AAPL, MSFT, TSM)"
                                style="flex: 1; padding: 10px; border: 2px solid #ddd; border-radius: 8px;"
                                onkeypress="if(event.key==='Enter') addTickerToPortfolio()"
                            >
                            <button onclick="addTickerToPortfolio()" class="btn btn-primary">
                                ➕ Add
                            </button>
                        </div>
                    </div>
                    
                    <h3>Saved Portfolio Tickers</h3>
                    <div id="savedTickersList" class="saved-tickers-list">
                        <!-- Saved tickers will be listed here -->
                    </div>
                    
                    <div class="modal-actions">
                        <button onclick="savePortfolioPreferences()" class="btn btn-success">
                            💾 Save Portfolio
                        </button>
                        <button onclick="clearAllTickers()" class="btn btn-danger">
                            🗑️ Clear All Tickers
                        </button>
                    </div>
                    
                    <div class="help-section">
                        <p><strong>Note:</strong> This is your saved portfolio, separate from the analysis session.</p>
                        <p><strong>Tip:</strong> Supports US, European, Japanese, and other global tickers (1-5 characters).</p>
                        <p>Remove individual tickers by clicking the × next to each one.</p>
                    </div>
                </div>
            </div>
        </div>
        
        <!-- AI Chat Assistant -->
        <div id="chatPanel" class="chat-panel">
            <div class="chat-header">
                <h3>🤖 AI Stock Assistant</h3>
                <button class="chat-toggle" onclick="toggleChat()">✕</button>
            </div>
            <div class="chat-messages" id="chatMessages">
                <div class="chat-message bot-message">
                    <div class="message-content">
                        👋 Hi! I can answer questions about the stocks you've analyzed. Try asking:
                        <ul style="margin: 10px 0; padding-left: 20px;">
                            <li>"What is the recommendation?"</li>
                            <li>"Why is the technical score high?"</li>
                            <li>"What is the current price?"</li>
                        </ul>
                    </div>
                </div>
            </div>
            <div class="chat-input-container">
                <select id="chatTicker" class="chat-ticker-select">
                    <option value="">Select Stock...</option>
                </select>
                <input type="text" id="chatInput" placeholder="Ask a question about the stock..." 
                       onkeypress="if(event.key==='Enter') sendChatMessage()" />
                <button onclick="sendChatMessage()" class="btn-chat-send">Send</button>
            </div>
        </div>
        
        <button class="chat-fab" onclick="toggleChat()" title="AI Assistant">
            🤖
        </button>
    </div>

    <script src="{{ url_for('static', filename='js/app.js') }}"></script>
</body>
</html>
